{"version":3,"sources":["webpack://mfModules.[name]/./src/mobile.categories.overlays/CategoryAddOverlay.js","webpack://mfModules.[name]/./src/mobile.categories.overlays/CategoryGateway.js","webpack://mfModules.[name]/./src/mobile.categories.overlays/CategoryLookupInputWidget.js","webpack://mfModules.[name]/./src/mobile.categories.overlays/CategoryTabs.js","webpack://mfModules.[name]/./src/mobile.categories.overlays/categoryOverlay.js","webpack://mfModules.[name]/./src/mobile.categories.overlays/mobile.categories.overlays.js"],"names":["Overlay","require","mfExtend","headers","util","CategoryGateway","CategoryLookupInputWidget","toast","router","mw","loader","CategoryAddOverlay","options","this","eventBus","call","extend","saveHeader","msg","title","savingHeader","className","events","click .save","click .suggestion","template","postRender","input","prototype","apply","$suggestions","$el","find","$saveButton","wgCategories","categories","gateway","api","suggestions","saveButton","append","$element","onCategoryClick","ev","target","closest","detach","length","prop","onSaveClick","newCategories","self","showHidden","each","data","show","type","save","then","navigate","notify","$safeButton","module","exports","actionParams","SearchGateway","parent","arguments","continueParams","canContinue","searchNamespace","postWithToken","action","appendtext","summary","getCategories","params","titles","clprop","cllimit","get","undefined","continue","OO","inheritClass","placeholder","ui","TextInputWidget","mixin","LookupElement","mixinClass","onLookupMenuItemChoose","button","ButtonWidget","icon","label","classes","flags","attr","getLookupRequest","search","value","getLookupCacheDataFromResponse","response","Title","results","unshift","toString","displayTitle","getMainText","getLookupMenuOptionsFromData","result","forEach","indexOf","push","MenuOptionWidget","View","spinner","ScrollEndEventEmitter","CategoryTabs","scrollEndEventEmitter","on","EVENT_SCROLL_END","_loadCategories","bind","click .catlink","isTemplateMode","defaults","normalcatlink","hiddencatlink","templatePartials","item","hideSpinner","hide","showSpinner","apiResult","$normalCatlist","$hiddenCatlist","setElement","disable","query","pages","page","category","newFromText","ns","hidden","render","url","getUrl","text","_changeView","enable","onCatlinkClick","preventDefault","hasClass","toggleClass","Anchor","header","overlay","widget","isAnon","href","additionalClassNames","subheading","m","categoryOverlay","define"],"mappings":"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","file":"mobile.categories.overlays.js","sourcesContent":["var\n\tOverlay = require( '../mobile.startup/Overlay' ),\n\tmfExtend = require( '../mobile.startup/mfExtend' ),\n\theaders = require( '../mobile.startup/headers' ),\n\tutil = require( '../mobile.startup/util' ),\n\tCategoryGateway = require( './CategoryGateway' ),\n\tCategoryLookupInputWidget = require( './CategoryLookupInputWidget' ),\n\ttoast = require( '../mobile.startup/toast' ),\n\trouter = mw.loader.require( 'mediawiki.router' );\n\n/**\n * Displays the list of categories for a page\n * @class CategoryAddOverlay\n * @extends Overlay\n * @uses CategoryGateway\n * @param {Object} options Configuration options\n * @param {OO.EventEmitter} options.eventBus Object used to emit category-added events\n */\nfunction CategoryAddOverlay( options ) {\n\tthis.eventBus = options.eventBus;\n\tOverlay.call(\n\t\tthis,\n\t\tutil.extend(\n\t\t\ttrue,\n\t\t\t{\n\t\t\t\theaders: [\n\t\t\t\t\theaders.saveHeader(\n\t\t\t\t\t\tmw.msg( 'mobile-frontend-categories-add-heading', options.title ),\n\t\t\t\t\t\t'initial-header'\n\t\t\t\t\t),\n\t\t\t\t\theaders.savingHeader( mw.msg( 'mobile-frontend-categories-add-wait' ) )\n\t\t\t\t],\n\t\t\t\tclassName: 'category-overlay overlay',\n\t\t\t\tevents: {\n\t\t\t\t\t'click .save': 'onSaveClick',\n\t\t\t\t\t'click .suggestion': 'onCategoryClick'\n\t\t\t\t}\n\t\t\t},\n\t\t\toptions\n\t\t)\n\t);\n}\n\nmfExtend( CategoryAddOverlay, Overlay, {\n\t/**\n\t * @inheritdoc\n\t * @memberof CategoryAddOverlay\n\t * @instance\n\t */\n\ttemplate: util.template( `\n<div class=\"overlay-header-container header-container position-fixed\"></div>\n<div class=\"content-header panel add-panel overlay-content\">\n\t<div class=\"category-add-input\"></div>\n</div>\n<p class=\"overlay-content category-suggestions panel\"></p>\n\t` ),\n\n\t/**\n\t * @inheritdoc\n\t * @memberof CategoryAddOverlay\n\t * @instance\n\t */\n\tpostRender: function () {\n\t\tvar input;\n\n\t\tOverlay.prototype.postRender.apply( this );\n\n\t\tthis.$suggestions = this.$el.find( '.category-suggestions' );\n\t\tthis.$saveButton = this.$el.find( '.save' );\n\t\tthis.wgCategories = this.options.categories;\n\t\tthis.title = this.options.title;\n\n\t\tthis.gateway = new CategoryGateway( this.options.api );\n\t\tinput = new CategoryLookupInputWidget( {\n\t\t\tgateway: this.gateway,\n\t\t\tsuggestions: this.$suggestions,\n\t\t\tcategories: this.wgCategories,\n\t\t\tsaveButton: this.$saveButton\n\t\t} );\n\t\tthis.$el.find( '.category-add-input' ).append(\n\t\t\tinput.$element\n\t\t);\n\t},\n\n\t/**\n\t * Handle a click on an added category\n\t * @memberof CategoryAddOverlay\n\t * @instance\n\t * @param {jQuery.Event} ev\n\t */\n\tonCategoryClick: function ( ev ) {\n\t\tthis.$el.find( ev.target ).closest( '.suggestion' ).detach();\n\t\tif ( this.$el.find( '.suggestion' ).length > 0 ) {\n\t\t\tthis.$saveButton.prop( 'disabled', false );\n\t\t} else {\n\t\t\tthis.$saveButton.prop( 'disabled', true );\n\t\t}\n\t},\n\n\t/**\n\t * Handle the click on the save button. Builds a string of new categories\n\t * and add it to the article.\n\t * @memberof CategoryAddOverlay\n\t * @instance\n\t */\n\tonSaveClick: function () {\n\t\tvar newCategories = '',\n\t\t\tself = this;\n\n\t\t// show the loading spinner and disable the safe button\n\t\tthis.showHidden( '.saving-header' );\n\n\t\t// add wikitext to add to the page\n\t\tthis.$el.find( '.suggestion' ).each( function () {\n\t\t\tvar data = self.$el.find( this ).data( 'title' );\n\n\t\t\tif ( data ) {\n\t\t\t\t// add the new categories in wikitext markup\n\t\t\t\tnewCategories += '\\n[[' + data + ']] ';\n\t\t\t}\n\t\t} );\n\n\t\t// if there are no categories added, don't do anything (the user shouldn't see the save\n\t\t// button)\n\t\tif ( newCategories.length === 0 ) {\n\t\t\ttoast.show( mw.msg( 'mobile-frontend-categories-nodata' ), { type: 'error' } );\n\t\t} else {\n\t\t\t// save the new categories\n\t\t\tthis.gateway.save( this.title, newCategories ).then( function () {\n\t\t\t\t// we're closing the overlay to show the user\n\t\t\t\t// that the action was completed successful\n\t\t\t\trouter.navigate( '#' );\n\t\t\t\tmw.notify( mw.msg( 'mobile-frontend-categories-notification' ) );\n\t\t\t}, function () {\n\t\t\t\tself.showHidden( '.initial-header' );\n\t\t\t\tself.$safeButton.prop( 'disabled', false );\n\t\t\t\t// FIXME: Should be a better error message\n\t\t\t\ttoast.show( mw.msg( 'mobile-frontend-categories-nodata' ), { type: 'error' } );\n\t\t\t} );\n\t\t}\n\t}\n} );\n\nmodule.exports = CategoryAddOverlay;\n","var\n\tprototype,\n\tactionParams = require( '../mobile.startup/actionParams' ),\n\tutil = require( '../mobile.startup/util' ),\n\tSearchGateway = require( '../mobile.startup/search/SearchGateway' );\n\n/**\n * Api for CategoryOverlay\n * @class CategoryGateway\n * @extends SearchGateway\n */\nfunction CategoryGateway() {\n\tCategoryGateway.parent.apply( this, arguments );\n}\nprototype = {\n\t/**\n\t * @memberof CategoryGateway\n\t * @instance\n\t */\n\tcontinueParams: {},\n\t/**\n\t * @memberof CategoryGateway\n\t * @instance\n\t */\n\tcanContinue: true,\n\t/**\n\t * @inheritdoc\n\t * @memberof CategoryGateway\n\t * @instance\n\t */\n\tsearchNamespace: 14,\n\t/**\n\t * Saves the categories passed to this function to the page\n\t * @memberof CategoryGateway\n\t * @instance\n\t * @param {string} title Title of the current page (to add the categories to)\n\t * @param {string} categories List of Categories to add\n\t * @return {jQuery.Deferred}\n\t */\n\tsave: function ( title, categories ) {\n\t\treturn this.api.postWithToken( 'csrf', {\n\t\t\taction: 'edit',\n\t\t\ttitle: title,\n\t\t\tappendtext: categories,\n\t\t\tsummary: mw.msg( 'mobile-frontend-categories-summary' )\n\t\t} );\n\t},\n\t/**\n\t * Returns the categories the title belongs to.\n\t * @memberof CategoryGateway\n\t * @instance\n\t * @param {string} title Title of the current page (to add the categories to)\n\t * @return {jQuery.Deferred|boolean} False, if no further continuation is possible,\n\t *                                   jQuery.Deferred otherwise.\n\t */\n\tgetCategories: function ( title ) {\n\t\tvar self = this, params;\n\n\t\tif ( this.canContinue === false ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tparams = util.extend( {}, {\n\t\t\tprop: 'categories',\n\t\t\ttitles: title,\n\t\t\tclprop: 'hidden',\n\t\t\tcllimit: 50\n\t\t}, this.continueParams );\n\t\treturn this.api.get( actionParams( params ) ).then( function ( data ) {\n\t\t\tif ( data.continue !== undefined ) {\n\t\t\t\tself.continueParams = data.continue;\n\t\t\t} else {\n\t\t\t\tself.canContinue = false;\n\t\t\t}\n\n\t\t\treturn data;\n\t\t} );\n\t}\n};\n\nOO.inheritClass( CategoryGateway, SearchGateway );\nutil.extend( CategoryGateway.prototype, prototype );\n\nmodule.exports = CategoryGateway;\n","/**\n * @class CategoryLookupInputWidget\n * @extends OO.ui.mixin.LookupElement\n *\n * @param {Object} options Configuration options\n * @param {CategoryGateway} options.gateway to use to retrieve search results\n * @param {jQuery.Object} options.suggestions container element for search suggestions\n * @param {jQuery.Object} options.saveButton element. Will get disabled when suggested item\n *                                           clicked.\n */\nfunction CategoryLookupInputWidget( options ) {\n\t// Note: this.$element is set to $( '<div>' ) by OOUI.\n\tthis.gateway = options.gateway;\n\tthis.$suggestions = options.suggestions;\n\tthis.categories = options.categories || [];\n\tthis.$saveButton = options.saveButton;\n\toptions.placeholder = mw.msg( 'mobile-frontend-categories-search' );\n\tOO.ui.TextInputWidget.call( this, options );\n\tOO.ui.mixin.LookupElement.call( this, options );\n}\nOO.inheritClass( CategoryLookupInputWidget, OO.ui.TextInputWidget );\nOO.mixinClass( CategoryLookupInputWidget, OO.ui.mixin.LookupElement );\n\n/**\n * Handle a click on a suggested item. Add it to the list of added categories and show save\n * button.\n * @memberof CategoryLookupInputWidget\n * @instance\n * @param {Object} data Data of the clicked element\n */\nCategoryLookupInputWidget.prototype.onLookupMenuItemChoose = function ( data ) {\n\tvar button = new OO.ui.ButtonWidget( {\n\t\ticon: 'check',\n\t\tlabel: data.label,\n\t\tclasses: [ 'suggestion', 'suggested' ],\n\t\tflags: [ 'progressive', 'primary' ]\n\t} );\n\n\tbutton.$element.attr( 'data-title', data.data );\n\tthis.$suggestions.append( button.$element );\n\tthis.$saveButton.prop( 'disabled', false );\n};\n\n/**\n * Returns the result of the search request.\n * @memberof CategoryLookupInputWidget\n * @instance\n * @return {jQuery.Deferred}\n */\nCategoryLookupInputWidget.prototype.getLookupRequest = function () {\n\treturn this.gateway.search( this.value );\n};\n\n/**\n * Get lookup cache item from server response data.\n * @memberof CategoryLookupInputWidget\n * @instance\n * @param {Mixed} response Response from server\n * @return {Mixed} Cached result response\n */\nCategoryLookupInputWidget.prototype.getLookupCacheDataFromResponse = function ( response ) {\n\tvar title = new mw.Title( this.value, 14 );\n\n\t// add user input as a possible (actually not existing) category\n\tresponse.results.unshift( {\n\t\ttitle: title.toString(),\n\t\tdisplayTitle: title.getMainText()\n\t} );\n\n\treturn response;\n};\n\n/**\n * Get a list of menu item widgets from the data stored by the lookup request's done handler.\n * @memberof CategoryLookupInputWidget\n * @instance\n * @param {Mixed} data Cached result data, usually an array\n * @return {Array} Array of OO.ui.MenuOptionWidget\n */\nCategoryLookupInputWidget.prototype.getLookupMenuOptionsFromData = function ( data ) {\n\tvar result = [],\n\t\t$el = this.$element,\n\t\tself = this;\n\n\tdata.results.forEach( function ( value ) {\n\t\tif (\n\t\t\t!$el.find( 'div[data-title=\"' + value.title + '\"]' ).length &&\n\t\t\tself.categories.indexOf( value.displayTitle ) === -1\n\t\t) {\n\t\t\tresult.push(\n\t\t\t\tnew OO.ui.MenuOptionWidget( {\n\t\t\t\t\tdata: value.title,\n\t\t\t\t\tlabel: value.displayTitle\n\t\t\t\t} )\n\t\t\t);\n\t\t}\n\t} );\n\treturn result;\n};\n\nmodule.exports = CategoryLookupInputWidget;\n","var\n\tmfExtend = require( '../mobile.startup/mfExtend' ),\n\tutil = require( '../mobile.startup/util' ),\n\tView = require( '../mobile.startup/View' ),\n\ticons = require( '../mobile.startup/icons' ),\n\tspinner = icons.spinner().$el,\n\tScrollEndEventEmitter = require( '../mobile.startup/ScrollEndEventEmitter' ),\n\tCategoryGateway = require( './CategoryGateway' );\n\n/**\n * Displays the list of categories for a page in two tabs\n * TODO: Break this into Tab and CategoryList components for better reuse.\n * @class CategoryTabs\n * @extends View\n * @uses CategoryGateway\n *\n * @param {Object} options Configuration options\n * @param {string} options.title of page to obtain categories for\n * @param {string} options.subheading for explaining the list of categories.\n * @param {mw.Api} options.api for use with CategoryGateway\n * @param {OO.EventEmitter} options.eventBus Object used to listen for category-added\n * and scroll:throttled events\n */\nfunction CategoryTabs( options ) {\n\tthis.scrollEndEventEmitter = new ScrollEndEventEmitter( options.eventBus );\n\tthis.scrollEndEventEmitter.on( ScrollEndEventEmitter.EVENT_SCROLL_END,\n\t\tthis._loadCategories.bind( this ) );\n\tthis.gateway = new CategoryGateway( options.api );\n\tView.call(\n\t\tthis,\n\t\tutil.extend(\n\t\t\ttrue,\n\t\t\t{ events: { 'click .catlink': 'onCatlinkClick' } },\n\t\t\toptions\n\t\t)\n\t);\n}\n\nmfExtend( CategoryTabs, View, {\n\tisTemplateMode: true,\n\t/**\n\t * @memberof CategoryTabs\n\t * @instance\n\t * @mixes View#defaults\n\t * @property {Object} defaults Default options hash.\n\t */\n\tdefaults: {\n\t\tnormalcatlink: mw.msg( 'mobile-frontend-categories-normal' ),\n\t\thiddencatlink: mw.msg( 'mobile-frontend-categories-hidden' )\n\t},\n\t/**\n\t * @inheritdoc\n\t * @memberof CategoryTabs\n\t * @instance\n\t */\n\ttemplate: util.template( `\n<div class=\"category-list\">\n\t<p class=\"content-header\">\n\t\t{{subheading}}\n\t</p>\n\t<ul class=\"category-header\">\n\t\t<li class=\"selected\">\n\t\t\t<a href=\"#\" class=\"catlink\">{{normalcatlink}}</a>\n\t\t</li><li>\n\t\t\t<a href=\"#\" class=\"catlink\">{{hiddencatlink}}</a>\n\t\t</li>\n\t</ul>\n\t<ul class=\"topic-title-list normal-catlist\"></ul>\n\t<ul class=\"topic-title-list hidden hidden-catlist\"></ul>\n</div>\n\t` ),\n\t/**\n\t * @inheritdoc\n\t * @memberof CategoryTabs\n\t * @instance\n\t */\n\ttemplatePartials: {\n\t\titem: util.template( `\n<li title=\"{{title}}\">\n    <a href=\"{{url}}\">{{title}}</a>\n</li>\n\t\t` )\n\t},\n\t/**\n\t * @inheritdoc\n\t * @memberof CategoryTabs\n\t * @instance\n\t */\n\tpostRender: function () {\n\t\tView.prototype.postRender.apply( this );\n\t\tthis.$el.append( spinner );\n\t\tthis._loadCategories();\n\t},\n\n\t/**\n\t * @memberof CategoryTabs\n\t * @instance\n\t * @return {void}\n\t */\n\thideSpinner: function () {\n\t\tthis.$el.find( '.spinner' ).hide();\n\t},\n\t/**\n\t * @memberof CategoryTabs\n\t * @instance\n\t * @return {void}\n\t */\n\tshowSpinner: function () {\n\t\tthis.$el.find( '.spinner' ).show();\n\t},\n\t/**\n\t * Get a list of categories the page belongs to and re-renders the overlay content\n\t * FIXME: CategoryTabs should be dumb and solely focus on rendering. This should\n\t * be refactored out at the earliest opportunity.\n\t * @memberof CategoryTabs\n\t * @instance\n\t */\n\t_loadCategories: function () {\n\t\tvar self = this,\n\t\t\t$normalCatlist = this.$el.find( '.normal-catlist' ),\n\t\t\t$hiddenCatlist = this.$el.find( '.hidden-catlist' ),\n\t\t\tapiResult;\n\n\t\tthis.scrollEndEventEmitter.setElement( this.$el );\n\t\t// ScrollEndEventEmitter is enabled once it's created, but we want to wait, until at\n\t\t// least one element is in the list before we enable it. So disable it here and enable\n\t\t// once the elements are loaded.\n\t\tthis.scrollEndEventEmitter.disable();\n\t\tapiResult = this.gateway.getCategories( this.options.title );\n\t\tif ( apiResult === false ) {\n\t\t\tself.hideSpinner();\n\t\t\treturn;\n\t\t}\n\t\tapiResult.then( function ( data ) {\n\t\t\tif ( data.query && data.query.pages ) {\n\t\t\t\t// add categories to overlay\n\t\t\t\tdata.query.pages.forEach( function ( page ) {\n\t\t\t\t\tif ( page.categories ) {\n\t\t\t\t\t\tpage.categories.forEach( function ( category ) {\n\t\t\t\t\t\t\tvar title = mw.Title.newFromText( category.title, category.ns );\n\n\t\t\t\t\t\t\tif ( category.hidden ) {\n\t\t\t\t\t\t\t\t$hiddenCatlist.append( self.templatePartials.item.render( {\n\t\t\t\t\t\t\t\t\turl: title.getUrl(),\n\t\t\t\t\t\t\t\t\ttitle: title.getMainText()\n\t\t\t\t\t\t\t\t} ) );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$normalCatlist.append( self.templatePartials.item.render( {\n\t\t\t\t\t\t\t\t\turl: title.getUrl(),\n\t\t\t\t\t\t\t\t\ttitle: title.getMainText()\n\t\t\t\t\t\t\t\t} ) );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\tif ( $normalCatlist.length === 0 && $normalCatlist.length === 0 ) {\n\t\t\t\t\tself.$el.find( '.content-header' ).text( mw.msg( 'mobile-frontend-categories-nocat' ) );\n\t\t\t\t} else if ( $normalCatlist.length === 0 && $normalCatlist.length > 0 ) {\n\t\t\t\t\tthis._changeView();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tself.$el.find( '.content-header' ).text( mw.msg( 'mobile-frontend-categories-nocat' ) );\n\t\t\t}\n\t\t\tself.hideSpinner();\n\t\t\tself.scrollEndEventEmitter.enable();\n\t\t} );\n\t},\n\n\t/**\n\t * Handles a click on one of the tabs to change the viewable categories\n\t * @memberof CategoryTabs\n\t * @instance\n\t * @param {jQuery.Event} ev The Event object triggered this handler\n\t */\n\tonCatlinkClick: function ( ev ) {\n\t\tev.preventDefault();\n\t\t// change view only, if the user clicked another view\n\t\tif ( !this.$el.find( ev.target ).parent().hasClass( 'selected' ) ) {\n\t\t\tthis._changeView();\n\t\t}\n\t},\n\n\t/**\n\t * Changes the view from hidden categories to content-based categories and vice-versa\n\t * @memberof CategoryTabs\n\t * @instance\n\t */\n\t_changeView: function () {\n\t\tthis.$el.find( '.category-header li' ).toggleClass( 'selected' );\n\t\tthis.$el.find( '.topic-title-list' ).toggleClass( 'hidden' );\n\t}\n} );\n\nmodule.exports = CategoryTabs;\n","var\n\tOverlay = require( '../mobile.startup/Overlay' ),\n\tAnchor = require( '../mobile.startup/Anchor' ),\n\theader = require( '../mobile.startup/headers' ).header,\n\tCategoryTabs = require( './CategoryTabs' );\n\n/**\n * Gets an overlay for displaying categories\n *\n * @param {Object} options Configuration options\n * @param {string} options.title of page to obtain categories for\n * @param {mw.Api} options.api for usage in CategoryTabs\n * @param {string} options.subheading for usage in CategoryTabs\n * @param {OO.EventEmitter} options.eventBus Object used to listen for category-added\n * and scroll:throttled events\n * @return {Overlay}\n */\nfunction categoryOverlay( options ) {\n\tvar overlay, widget;\n\toverlay = new Overlay( {\n\t\tclassName: 'category-overlay overlay',\n\t\theaders: [\n\t\t\theader(\n\t\t\t\tmw.msg( 'mobile-frontend-categories-heading' ),\n\t\t\t\toptions.isAnon ? [] : [\n\t\t\t\t\tnew Anchor( {\n\t\t\t\t\t\thref: '#/categories/add',\n\t\t\t\t\t\tlabel: mw.msg( 'mobile-frontend-categories-add' ),\n\t\t\t\t\t\tadditionalClassNames: 'add continue'\n\t\t\t\t\t} )\n\t\t\t\t]\n\t\t\t)\n\t\t]\n\t} );\n\twidget = new CategoryTabs(\n\t\t{\n\t\t\teventBus: options.eventBus,\n\t\t\tapi: options.api,\n\t\t\ttitle: options.title,\n\t\t\tsubheading: mw.msg( 'mobile-frontend-categories-subheading' )\n\t\t}\n\t);\n\toverlay.$el.find( '.overlay-content' ).append( widget.$el );\n\treturn overlay;\n}\n\nmodule.exports = categoryOverlay;\n","var m = require( '../mobile.startup/moduleLoaderSingleton' ),\n\tCategoryAddOverlay = require( './CategoryAddOverlay' ),\n\tcategoryOverlay = require( './categoryOverlay' );\n\n// needed for minerva usages\nm.define( 'mobile.categories.overlays/CategoryAddOverlay', CategoryAddOverlay );\nm.define( 'mobile.categories.overlays/categoryOverlay', categoryOverlay );\n"],"sourceRoot":""}